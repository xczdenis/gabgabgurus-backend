name: Tests workflow

env:
    ENVIRONMENT: development
    DOCKER_IMG_PLATFORM: linux/amd64

on:
    pull_request:
    workflow_dispatch:

jobs:
    tests:
        name: Run tests ğŸ§ª
        runs-on: ubuntu-latest
        steps:
            -   name: Check out the repo ğŸ“¥
                uses: actions/checkout@v4

            -   name: Create env file âš™ï¸
                #                run: printf "${{ secrets.ENVS_DEV }}" >> .env
                run: echo -e "${{ secrets.ENVS_DEV }}" >> .env

            #            -   name: Build docker containers ğŸ³
            #                run: DOCKER_BUILDKIT=1 docker compose -f docker-compose.yml -f docker-compose.dev.yml --profile default build

            -   name: Prepare docker ğŸ³
                run: make docker-prepare

            -   name: Start docker containers ğŸš€
                run: DOCKER_BUILDKIT=1 docker compose -f docker-compose.yml -f docker-compose.dev.yml --profile default up -d --build

            -   name: Run tests âœ…
                run: python -m pytest
