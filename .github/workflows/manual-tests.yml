name: Tests workflow

env:
    ENVIRONMENT: development
    DOCKER_IMG_PLATFORM: linux/amd64

on:
    workflow_dispatch:

jobs:
    tests:
        name: Run tests ğŸ§ª
        runs-on: ubuntu-latest
        steps:
            -   name: Check out the repo ğŸ“¥
                uses: actions/checkout@v4

            -   name: Create env file âš™ï¸
                run: echo -e "${{ secrets.ENVS_DEV }}" >> .env

            -   name: Prepare docker ğŸ³
                run: make docker-prepare

            -   name: Start docker containers ğŸš€
                run: docker compose -f docker-compose.yml -f docker-compose.dev.yml -f docker-compose.test.yml --profile default up -d --build

            -   name: Run tests in docker âœ…
                run: docker compose -f docker-compose.yml -f docker-compose.dev.yml -f docker-compose.test.yml --profile tests run tests
